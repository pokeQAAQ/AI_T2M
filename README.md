# AI音乐创作应用 - Orange Pi Zero 3 版本

基于火山引擎API的AI音乐生成应用，专为Orange Pi Zero 3（1GB内存，16GB TF卡，1024x600分辨率）优化设计。

## 功能特性

- 🎤 **语音录制与识别**：使用现有的录音和ASR模块，支持语音转文字
- 🎵 **AI音乐生成**：基于火山引擎Imagination API，生成完整的歌曲
- 🎶 **音乐播放**：内置播放器，支持在线流媒体播放和历史记录
- 🎨 **深色主题**：专为1024x600横屏设计的现代化深色界面
- 📱 **触屏友好**：优化的按钮尺寸和布局，适合触屏操作

## 界面设计

### 1. 录音转文字界面
- 大标题"Create your music"和中文副标题"开启你的创作"
- 文本输入框，支持手动输入或语音转文字
- 音乐风格、情绪、声音性别选择下拉列表
- 圆形录音按钮（使用提供的button.png图标）
- 下一步按钮（所有参数填写完成后激活）

### 2. 音乐生成界面
- 全屏加载动画（使用提供的loading.gif）
- 实时进度显示和状态更新
- 生成任务的详细信息展示

### 3. 音乐播放界面
- 左上方：GIF动画区域
- 右上方：歌曲名称和信息显示
- 下方控制栏：
  - 历史音乐按钮（三条横线图标）
  - 播放控制：上一首、播放/暂停、下一首
  - 进度条和时间显示
- 历史记录列表（可切换显示）

## 安装和运行

### 环境要求
- Python 3.8+
- Orange Pi Zero 3 或兼容的ARM64设备
- 网络连接（用于API调用和音频流播放）

### 安装依赖
```bash
pip install -r requirements.txt
```

### 配置文件
应用使用`config.py`文件进行配置，其中包含：
- 火山引擎API凭据（已内置）
- 音乐风格和情绪选项
- UI主题配置
- 音频参数设置

**注意：`config.py`包含敏感的API密钥，已添加到.gitignore中。**

### 运行应用
```bash
# 测试核心功能
python test_core.py

# 启动完整应用（需要图形界面）
python music_app.py
```

## 文件结构

```
AI_T2M/
├── music_app.py              # 主应用程序
├── config.py                 # 配置文件（包含API密钥）
├── requirements.txt          # Python依赖
├── test_core.py             # 核心功能测试
├── music/                   # 音乐生成模块
│   ├── __init__.py
│   ├── sign.py              # API签名工具
│   ├── generator.py         # 音乐生成客户端
│   └── player.py            # 音乐播放器
├── ui/                      # 用户界面模块
│   ├── __init__.py
│   ├── recording_screen.py  # 录音转文字界面
│   ├── generation_screen.py # 音乐生成界面
│   └── playback_screen.py   # 音乐播放界面
├── threads/                 # 现有线程模块（复用）
│   ├── record_thread.py     # 录音线程
│   └── asr_thread.py        # 语音识别线程
├── Icon/                    # 图标资源
│   ├── button.png           # 录音按钮图标
│   └── loading.gif          # 加载动画
└── utils/                   # 工具模块（现有）
    └── config.py            # 原有配置（部分功能保留）
```

## API集成

### 火山引擎Imagination API
- **歌词生成**：`GenLyrics` - 同步接口，直接返回歌词
- **歌曲生成**：`GenSongV4` - 异步接口，创建生成任务
- **任务查询**：`QuerySong` - 轮询生成状态和结果
- **使用量查询**：`QueryUsage` - 检查API配额

### 支持的参数
- **风格**：流行、摇滚、嘻哈、民谣、R&B、电子、古典、爵士、乡村、布鲁斯
- **情绪**：欢快、悲伤、浪漫、活力、平静、忧郁、兴奋、和平、怀旧、振奋
- **声音**：男声、女声、中性

## 硬件优化

针对Orange Pi Zero 3的优化：
- 使用软件渲染减少GPU负担
- 优化内存使用，适配1GB RAM限制
- 异步处理避免界面卡顿
- 缓存机制减少重复网络请求
- 适配1024x600分辨率的UI布局

## 安全性

- API密钥通过配置文件管理，已加入.gitignore
- 使用HMAC-SHA256签名确保API请求安全
- 临时文件自动清理
- 网络请求超时和重试机制

## 故障排除

### 常见问题

1. **录音失败**
   - 检查音频设备权限
   - 确认alsa-utils已安装（用于arecord）
   - 检查麦克风硬件连接

2. **API调用失败**
   - 验证网络连接
   - 检查API密钥配置
   - 查看日志文件（/tmp/ai_music.log）

3. **界面显示问题**
   - 确认分辨率设置为1024x600
   - 检查PySide6安装和图形系统支持
   - 尝试使用不同的Qt后端

4. **音频播放问题**
   - 检查音频输出设备
   - 确认网络连接稳定（流媒体播放）
   - 验证音频文件格式支持

### 日志文件
- 应用日志：`/tmp/ai_music.log`
- 音频缓存：`/tmp/ai_music_cache/`
- 历史记录：`/tmp/music_history.json`

## 开发和定制

### 扩展功能
- 添加更多音乐风格和情绪选项
- 集成本地音频文件播放
- 实现歌词显示功能
- 添加音频效果和均衡器

### 主题定制
编辑`config.py`中的`DARK_THEME`字典来自定义颜色方案。

### API扩展
在`music/generator.py`中可以添加更多火山引擎API的支持。

## 许可证

本项目遵循原始仓库的许可证条款。火山引擎API的使用需要遵循相应的服务条款。

## 支持

如有问题或建议，请查看：
1. 日志文件中的错误信息
2. 运行`python test_core.py`检查核心功能
3. 确认硬件和网络环境符合要求